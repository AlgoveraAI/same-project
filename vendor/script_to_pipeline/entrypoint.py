import io; import site; import sys; from base64 import b64decode; from importlib import import_module, reload; from pathlib import Path; from subprocess import run; import tarfile; from tempfile import TemporaryDirectory; dependencies = sys.argv[2:]; run(["pip", "--disable-pip-version-check", "install", *dependencies]); reload(site); tar_bytes = sys.argv[1]; buffer = io.BytesIO(b64decode(tar_bytes)); root_module = sys.argv[2]; tempdir = Path("."); tar = tarfile.open(fileobj=buffer, mode="r:gz"); tar.extractall(tempdir); p = Path(tempdir) / "context" / "requirements.txt"; p.exists() and run(["pip", "--disable-pip-version-check", "install", "-r", p.as_posix()]); sys.path.append((Path(tempdir) / "context").as_posix()); script = import_module(root_module); script.root()
